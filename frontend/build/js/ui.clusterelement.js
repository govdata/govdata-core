define(["utils","jquery","jquery-ui","ui.linearchooser","ui.clusterelement"],function(){$.widget("ui.clusterelement",{options:{},_create:function(){var a=this.options.key,l=this.options.results,h=this.options.collapse,c=this.options.start,d=this.options.hidedict,m=this.options.renderer,i=this.options.facet_dict,j=d.items[a]||false;classtext=j===true?"keyLabel hide":"keyLabel";var n="<div class='facetCount'>("+i[a]+" Slices)</div>",o=$("<div class='topBar'></div>").appendTo(this.element),b;b=h!="QUERY"?
a.split("|").slice(c):a.split("|").slice(c,-1);$.each(b,function(e,p){b[e]='<span class="value">'+p+"</span>"});$.each(b.slice(0,-1),function(e){b[e]+=" > "});c=$("<div class='outerkeydiv'></div>").appendTo(o);var f=$("<div class='keyToggle'>&#9660</div>").appendTo(c),g=$("<div class='linearChooser "+classtext+"'></div>").appendTo(c).linearchooser({data:{label:"",list:[{label:"key",list:b}],resp:[_.range(b.length)]}});$(n).appendTo(c);var k=m(this.element,l,h,i[a],a);j===true&&k.hide();f.click(function(){k.toggle();
if(g.hasClass("hide")){g.removeClass("hide");d.remove(a);f.html("<div class='keyToggle'>&#9660</div>")}else{g.addClass("hide");d.add(a,true);f.html("<div class='keyToggle'>&#9654</div>")}$(root).data().statehandler.changestate()})},destroy:function(){this.element.empty()}})});