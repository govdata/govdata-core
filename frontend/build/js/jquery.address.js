define(["jquery"],function(){$.address=function(){var u=function(a){$($.address).trigger($.extend($.Event(a),function(){for(var b={},c=$.address.parameterNames(),g=0,n=c.length;g<n;g++)b[c[g]]=$.address.parameter(c[g]);return{value:$.address.value(),path:$.address.path(),pathNames:$.address.pathNames(),parameterNames:c,parameters:b,queryString:$.address.queryString()}}.call($.address)))},v=function(a,b,c){$($.address).bind(a,b,c);return $.address},x=function(){return w.pushState&&d.state!==h},G=function(){return("/"+
f.pathname.replace(new RegExp(d.state),"")+f.search+(F()?"#"+F():"")).replace(X,"/")},F=function(){var a=f.href.indexOf("#");return a!=-1?y(f.href.substr(a+1),false):""},r=function(){return x()?G():F()},na=function(){return"javascript"},o=function(a){return d.strict&&a==""?"/":a},y=function(a,b){if(d.crawlable&&b)return(a!=""?"!":"")+a;return a.replace(/^\!/,"")},z=function(a,b){return parseInt(a.css(b),10)},Y=function(a){for(var b,c,g=0,n=a.childNodes.length;g<n;g++){if(a.childNodes[g].src)b=String(a.childNodes[g].src);
if(c=Y(a.childNodes[g]))b=c}return b},K=function(){if(!O){var a=r(),b=e!=a;if(A&&m<523){if(H!=w.length){H=w.length;if(E[H-1]!==h)e=E[H-1];I(false)}}else if(b)if(B&&m<7)f.reload();else{B&&m<8&&d.history&&s(R,50);e=a;I(false)}}},I=function(a){u("change");u(a?"internalChange":"externalChange");s(Z,10)},Z=function(){if(d.tracker!=="null"&&d.tracker!==null){var a=$.isFunction(d.tracker)?d.tracker:j[d.tracker],b=(f.pathname+f.search+($.address&&!x()?$.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,
"");if($.isFunction(a))a(b);else if($.isFunction(j.urchinTracker))j.urchinTracker(b);else if(j.pageTracker!==h&&$.isFunction(j.pageTracker._trackPageview))j.pageTracker._trackPageview(b);else j._gaq!==h&&$.isFunction(j._gaq.push)&&j._gaq.push(["_trackPageview",b])}},R=function(){var a=na()+":false;document.open();document.writeln('<html><head><title>"+k.title.replace("'","\\'")+'</title><script>var jQueryAddress = "'+encodeURIComponent(r())+(k.domain!=f.host?'";document.domain="'+k.domain:"")+"\";<\/script></head></html>');document.close();";
if(m<7)l.src=a;else l.contentWindow.location.replace(a)},ba=function(){if(L&&aa!=-1){var a,b=L.substr(aa+1).split("&");for(q=0;q<b.length;q++){a=b[q].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))d[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))d[a[0]]=a[1]}L=null}e=r()},da=function(){if(!ca){ca=true;ba();var a=function(){oa.call(this);pa.call(this)},b=$("body").ajaxComplete(a);a();if(d.wrap){$("body > *").wrapAll('<div style="padding:'+
(z(b,"marginTop")+z(b,"paddingTop"))+"px "+(z(b,"marginRight")+z(b,"paddingRight"))+"px "+(z(b,"marginBottom")+z(b,"paddingBottom"))+"px "+(z(b,"marginLeft")+z(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="jQueryAddress" style="height:100%;overflow:auto;position:relative;'+(A?window.statusbar.visible&&!/chrome/i.test(S)?"":"resize:both;":"")+'" />');$("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});A&&$('<style type="text/css" />').appendTo("head").text("#jQueryAddress::-webkit-resizer { background-color: #fff; }")}if(B&&
m<8){a=k.getElementsByTagName("frameset")[0];l=k.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",l);a[a.cols?"cols":"rows"]+=",0";l.noResize=true;l.frameBorder=l.frameSpacing=0}else{l.style.display="none";l.style.width=l.style.height=0;l.tabIndex=-1;k.body.insertAdjacentElement("afterBegin",l)}s(function(){$(l).bind("load",function(){var c=l.contentWindow;e=c.jQueryAddress!==h?c.jQueryAddress:"";if(e!=r()){I(false);f.hash=y(e,true)}});l.contentWindow.jQueryAddress===h&&
R()},50)}else if(A){if(m<418){$(k.body).append('<form id="jQueryAddress" style="position:absolute;top:-9999px;" method="get"></form>');T=k.getElementById("jQueryAddress")}if(f.jQueryAddress===h)f.jQueryAddress={};if(f.jQueryAddress[f.pathname]!==h)E=f.jQueryAddress[f.pathname].split(",")}s(function(){u("init");I(false)},1);if(!x())if(B&&m>7||!B&&"onhashchange"in j)if(j.addEventListener)j.addEventListener("hashchange",K,false);else j.attachEvent&&j.attachEvent("onhashchange",K);else qa(K,50)}},oa=
function(){var a,b=$("a"),c=b.size(),g=-1;s(function(){if(++g!=c){a=$(b.get(g));a.is("[rel*=address:]")&&a.address();s(arguments.callee,1)}},1)},ra=function(){if(e!=r()){e=r();I(false)}},sa=function(){if(j.removeEventListener)j.removeEventListener("hashchange",K,false);else j.detachEvent&&j.detachEvent("onhashchange",K)},pa=function(){if(d.crawlable){var a=f.pathname.replace(/\/$/,"");$("body").html().indexOf("_escaped_fragment_")!=-1&&$("a[href]:not([href^=http]), , a[href*="+document.domain+"]").each(function(){var b=
$(this).attr("href").replace(/^http:/,"").replace(new RegExp(a+"/?$"),"");if(b==""||b.indexOf("_escaped_fragment_")!=-1)$(this).attr("href","#"+$.address.decode(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2")))})}},C=function(a){return ea(fa(a)).replace(/%20/g,"+")},ga=function(a){return a.split("#")[0].split("?")[0]},ha=function(a){a=ga(a);var b=a.replace(X,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},M=function(a){a=
a.split("?");return a.slice(1,a.length).join("?").split("#")[0]},ia=function(a,b){if(b=M(b)){params=b.split("&");b=[];for(q=0;q<params.length;q++){var c=params[q].split("=");if(c[0]==a||$.address.decode(c[0])==a)b.push(c.slice(1).join("="))}if(b.length!==0)return b.length!=1?b:b[0]}},ja=function(a){var b=M(a);a=[];if(b&&b.indexOf("=")!=-1){b=b.split("&");for(var c=0;c<b.length;c++){var g=b[c].split("=")[0];$.inArray(g,a)==-1&&a.push(g)}}return a},P=function(a){a=a.split("#");return a.slice(1,a.length).join("#")},
h,d={autoUpdate:true,crawlable:false,history:true,strict:true,wrap:false},p=$.browser,m=parseFloat($.browser.version),ka=p.mozilla,B=p.msie,la=p.opera,A=p.webkit||p.safari,U=false,j=function(){try{return top.document!==h?top:window}catch(a){return window}}(),k=j.document,w=j.history,f=j.location,qa=setInterval,s=setTimeout,ea=encodeURIComponent,fa=decodeURIComponent,X=/\/{2,9}/g,S=navigator.userAgent,l,T,L=Y(document),aa=L?L.indexOf("?"):-1,V=k.title,H=w.length,O=false,ca=false,W=true,ma=true,Q=false,
E=[],e=r();if(B){m=parseFloat(S.substr(S.indexOf("MSIE")+4));if(k.documentMode&&k.documentMode!=m)m=k.documentMode!=8?7:8;$(document).bind("propertychange",function(){if(k.title!=V&&k.title.indexOf("#"+r())!=-1)k.title=V})}if(U=ka&&m>=1||B&&m>=6||la&&m>=9.5||A&&m>=312){for(var q=1;q<H;q++)E.push("");E.push(e);if(la)history.navigationMode="compatible";if(document.readyState=="complete")var ta=setInterval(function(){if($.address){da();clearInterval(ta)}},50);else{ba();$(da)}p=G();if(d.state!==h)if(w.pushState)p.substr(0,
3)=="/#/"&&f.replace(d.state.replace(/^\/$/,"")+p.substr(2));else p!="/"&&p.replace(/^\/#/,"")!=F()&&f.replace(d.state.replace(/^\/$/,"")+"/#"+p);$(window).bind("popstate",ra).bind("unload",sa)}else!U&&F()!=""||A&&m<418&&F()!=""&&f.search!=""?f.replace(f.href.substr(0,f.href.indexOf("#"))):Z();return{bind:function(a,b,c){return v(a,b,c)},init:function(a){return v("init",a)},change:function(a){return v("change",a)},internalChange:function(a){return v("internalChange",a)},externalChange:function(a){return v("externalChange",
a)},baseURL:function(){var a=f.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==h){d.autoUpdate=a;return this}return d.autoUpdate},crawlable:function(a){if(a!==h){d.crawlable=a;return this}return d.crawlable},history:function(a){if(a!==h){d.history=a;return this}return d.history},state:function(a){if(a!==h){d.state=a;return this}return d.state},strict:function(a){if(a!==h){d.strict=a;return this}return d.strict},
tracker:function(a){if(a!==h){d.tracker=a;return this}return d.tracker},wrap:function(a){if(a!==h){d.wrap=a;return this}return d.wrap},update:function(){Q=true;this.value(e);Q=false;return this},encode:function(a){var b=ha(a),c=ja(a),g=M(a),n=P(a),D=a.substr(0,1),J=a.substr(a.length-1),i="";$.each(b,function(t,N){i+="/"+C(N)});if(g!==""){i+="?";if(c.length===0)i+=g;else{$.each(c,function(t,N){t=ia(N,a);if(typeof t!=="string")$.each(t,function(va,ua){i+=C(N)+"="+C(ua)+"&"});else i+=C(N)+"="+C(t)+"&"});
i=i.substr(0,i.length-1)}}if(n!=="")i+="#"+C(n);if(D!="/"&&i.substr(0,1)=="/")i=i.substr(1);if(D=="/"&&i.substr(0,1)!="/")i="/"+i;if(/#|&|\?/.test(J))i+=J;return i},decode:function(a){if(a!==h){var b=[],c=function(D){return fa(D.toString().replace(/\+/g,"%20"))};if(typeof a=="object"&&a.length!==h){for(var g=0,n=a.length;g<n;g++)b[g]=c(a[g]);return b}else return c(a)}},title:function(a){if(a!==h){s(function(){V=k.title=a;if(ma&&l&&l.contentWindow&&l.contentWindow.document){l.contentWindow.document.title=
a;ma=false}if(!W&&ka)f.replace(f.href.indexOf("#")!=-1?f.href:f.href+"#");W=false},50);return this}return k.title},value:function(a){if(a!==h){a=(a.substr(0,1)!="/"?"/":"")+this.encode(a);if(a=="/")a="";if(e==a&&!Q)return;W=true;e=a;if(d.autoUpdate||Q){I(true);if(x())w[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(e==""?"/":e));else{O=true;E[w.length]=e;if(A)if(d.history){f.jQueryAddress[f.pathname]=E.toString();H=w.length+1;if(m<418){if(f.search==""){T.action="#"+y(e,true);
T.submit()}}else if(m<523||e==""){a=k.createEvent("MouseEvents");a.initEvent("click",true,true);var b=k.createElement("a");b.href="#"+y(e,true);b.dispatchEvent(a)}else f.hash="#"+y(e,true)}else f.replace("#"+y(e,true));else if(e!=r())if(d.history)f.hash="#"+y(e,true);else f.replace("#"+y(e,true));B&&m<8&&d.history&&s(R,50);if(A)s(function(){O=false},1);else O=false}}return this}if(!U)return null;return this.decode(o(e))},path:function(a){if(a!==h){var b=M(o(e)),c=P(o(e));this.value(a+(b?"?"+b:"")+
(c?"#"+c:""));return this}return this.decode(ga(o(e)))},pathNames:function(){return this.decode(ha(o(e)))},queryString:function(a){if(a!==h){var b=P(o(e));this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}return this.decode(M(o(e)))},parameter:function(a,b,c){var g,n;if(b!==h){var D=this.parameterNames();n=[];b=b?ea(b):"";for(g=0;g<D.length;g++){var J=D[g],i=this.parameter(J);if(typeof i=="string")i=[i];if(J==a)i=b===null||b===""?[]:c?i.concat([b]):[b];for(var t=0;t<i.length;t++)n.push(J+
"="+C(i[t]))}$.inArray(a,D)==-1&&b!==null&&b!==""&&n.push(a+"="+C(b));this.queryString(n.join("&"));return this}return this.decode(ia(a,o(e)))},parameterNames:function(){return this.decode(ja(o(e)))},parameters:function(){for(var a={},b=this.parameterNames(),c,g=0;g<b.length;g++){c=b[g];a[c]=this.parameter(c)}return a},hash:function(a){if(a!==h){this.value(o(e).split("#")[0]+(a?"#"+a:""));return this}return this.decode(P(o(e)))},jsonhash:function(a){if(a!==h)return this.hash(JSON.stringify(a));a=
this.hash(a);if(a==="")return null;return JSON.parse(a)}}}();$.fn.address=function(u){if(!$(this).attr("address")){var v=function(x){if($(this).is("a")){var G=u?u.call(this):/address:/.test($(this).attr("rel"))?$(this).attr("rel").split("address:")[1].split(" ")[0]:$.address.state()!==undefined&&$.address.state()!="/"?$(this).attr("href").replace(new RegExp("^(.*"+$.address.state()+"|\\.)"),""):$(this).attr("href").replace(/^(#\!?|\.)/,"");$.address.value(G);x.preventDefault()}};$(this).click(v).live("click",
v).submit(function(x){if($(this).is("form")){var G=u?u.call(this):$(this).attr("action")+"?"+$.address.decode($(this).serialize());$.address.value(G);x.preventDefault()}}).attr("address",true)}return this}});