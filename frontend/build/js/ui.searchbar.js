define(["jquery","jquery-ui","ui.bubbles"],function(){$.widget("ui.searchbar",{_create:function(){var a=this,d=a.options.autocomplete,b=a.element;b=$("<div id='searchEltContainer'></div>").appendTo(b);bubbles=$("<ul class='bubbles'></ul>").bubbles().appendTo(b).data("bubbles");input=$("<input type='text' />").appendTo(b);input.unbind("keydown");input.autocomplete(d);input.bind("keydown","return",function(){var c=_.trim(input.val());if(c!==""){a.addBubble(c);input.val("")}a.submit();return false});
this.bubbles=bubbles;this.q=this.options.query;this.listenTo(this.q,"update",this.update)},update:function(){var a=this,d=a.q.items;a.element.find(".bubble").remove();$.each(d,function(b,c){a.addBubble(c)});$.each(a.q.filteritems,function(b,c){a.addBubble(c,"fq")})},submit:function(){this.q.update(this.bubbles.value());$(root).data().statehandler.changestate()},addBubble:function(a,d){var b=this;this.bubbles.add(a,d).find(".remover").click(function(){b.submit()})},destroy:function(){this.element.empty()}})});